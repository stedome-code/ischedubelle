```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Isabelle Scheduling Assistant â€” Updated</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #ffffff;
        --text: #000000;
        --primary: #000000;
      }

      * {
        box-sizing: border-box;
      }
      body,
      html {
        margin: 0;
        height: 100%;
        background: var(--bg);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        color: var(--text);
        display: grid;
        place-items: center;
      }

      /* Prevent SweetAlert shifting */
      body.swal2-shown {
        position: fixed !important;
        width: 100% !important;
        overflow: hidden !important;
        padding-right: 0 !important;
      }

      #stage {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: min(980px, 94vw);
        height: min(980px, 94vh);
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }

      .screen {
        position: absolute;
        inset: 0;
        display: none;
        padding: 22px;
      }
      .screen.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: 100%;
        max-width: 820px;
        background: transparent;
        text-align: center;
        padding: 18px;
      }

      h1 {
        margin: 0 0 10px;
        font-size: 28px;
        color: #000;
      }
      p {
        margin: 0 0 14px;
        font-size: 15px;
        color: #000;
      }

      .btn-green {
        border: 1px solid #000;
        border-radius: 10px;
        padding: 10px 18px;
        font-size: 16px;
        cursor: pointer;
        color: #fff;
        background: #229131;
        transition: 0.12s ease;
      }

      .btn-red {
        border: 1px solid #000;
        border-radius: 10px;
        padding: 10px 18px;
        font-size: 16px;
        cursor: pointer;
        color: #fff;
        background: #c52c2cdd;
        transition: 0.12s ease;
      }

      .btn {
        border: 1px solid #000;
        border-radius: 10px;
        padding: 10px 18px;
        font-size: 16px;
        cursor: pointer;
        color: #fff;
        background: #000;
        transition: 0.12s ease;
      }
      .btn:hover {
        background: #333;
        transform: translateY(-1px);
      }
      .btn:active {
        background: #111;
        transform: translateY(0);
      }
      .btn-outline {
        background: transparent;
        color: #000;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-top: 12px;
      }
      .grid-3 img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        cursor: pointer;
        border: 3px solid transparent;
        border-radius: 12px;
      }
      .grid-3 img.selected {
        border-color: #000;
      }

      .muted {
        opacity: 0.65;
      }

      /* trolley layout */
      .trolley {
        display: flex;
        gap: 18px;
        align-items: center;
        justify-content: center;
        margin-top: 12px;
      }
      .panel {
        width: 48%;
        text-align: left;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #000;
      }
      .panel img {
        width: 100%;
        border-radius: 8px;
        height: 220px;
        object-fit: cover;
      }
      textarea.explain {
        width: 100%;
        min-height: 64px;
        margin-top: 8px;
        padding: 8px;
        font-size: 14px;
        border-radius: 6px;
        border: 1px solid #ccc;
        resize: vertical;
      }

      .activities-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 12px;
      }
      .activity-card {
        border: 1px solid #000;
        border-radius: 10px;
        padding: 10px;
        text-align: left;
        display: flex;
        gap: 12px;
        align-items: center;
        cursor: pointer;
        background: #fff;
      }
      .activity-card.selected {
        background: #000;
        color: #fff;
      }
      .activity-card img {
        width: 96px;
        height: 72px;
        object-fit: cover;
        border-radius: 8px;
      }
      .activity-body {
        flex: 1;
      }
      .activity-title {
        font-weight: 600;
        margin-bottom: 6px;
      }
      .activity-desc {
        font-size: 13px;
        opacity: 0.9;
      }

      .propose-row {
        margin-top: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .propose-row input[type="text"] {
        flex: 1;
        padding: 8px;
        font-size: 14px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      .consent-row {
        margin-top: 12px;
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
      }
      .consent-row label {
        font-size: 13px;
      }

      /* boxed GIF container */
      .gif-box {
        width: 80%;
        max-width: 680px;
        height: 360px;
        border-radius: 12px;
        overflow: auto;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px auto 0;
        background: #fafafa;
      }
      .gif-box img {
        width: 100%;
        height: auto;
        max-height: 100%;
        object-fit: contain;
        display: block;
      }

      /* simple dropdown style */
      .select-row {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: center;
        margin-top: 12px;
      }
      select,
      input[type="text"],
      textarea {
        padding: 10px;
        font-size: 16px;
        border-radius: 8px;
        border: 1px solid #000;
      }

      .first-image {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 8px;
        display: block;
        margin: 0 auto 12px;
      }

      .swal2-popup {
        background: #ffffff !important;
        color: #000000 !important;
        border: 1px solid #000;
        border-radius: 6px;
      }
      .swal2-title {
        color: #000 !important;
        font-weight: 600;
      }
      .swal2-html-container {
        color: #000 !important;
      }

      .footer-row {
        position: absolute;
        bottom: 12px;
        left: 24px;
        right: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .note {
        margin: 0;
        height: 10%;
        background: var(--bg);
        font-family: "Times New Roman", Times, serif;
        color: var(--text);
        display: grid;
        place-items: center;
      }

      @media (max-width: 800px) {
        .activities-grid {
          grid-template-columns: 1fr;
        }
        .trolley {
          flex-direction: column;
        }
        .panel {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div id="stage">
      <!-- 1. Are you Isabelle? -->
      <section id="screen-areyou" class="screen active">
        <div class="card">
          <img
            id="firstMediaPreview"
            class="first-image"
            src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"
            alt="preview"
          />
          <h1>A Scheduling Assistant just for Isabelle</h1>
          <p class="muted">Please confirm your identity to continue.</p>
          <p class="muted">
            Oh, and please don't refresh the page â€” you'll have to start again.
            This website is programmed catastrophically lol
          </p>
          <div style="margin-top: 12px">
            <button id="btnIsabelle" class="btn">Yes, I'm Isabelle</button>
            <button
              id="btnNot"
              class="btn btn-outline"
              style="margin-left: 12px"
            >
              No, I'm not
            </button>
          </div>
        </div>
      </section>

      <footer>
        <div class="footer-row">
          <small class="note"
            >Built for Isabelle â€¢ Because she has problems scheduling stuff and
            i want to annoy her :))</small
          >
          <small class="note"
            >Â© 2025 Ischedubelle, made with sheer stupidity and a bit of love
          </small>
        </div>
      </footer>

      <!-- 2. Select a cat (3 images) -->
      <section id="screen-cats" class="screen">
        <div class="card">
          <h1>First up â€” quick identity verification</h1>
          <p class="muted">Pick a cat which suits you the best.</p>
          <div class="grid-3" id="catGrid"></div>
          <button id="catNext" class="btn" style="margin-top: 14px">
            Continue
          </button>
        </div>
      </section>

      <!-- 2.1 -->
      <section id="screen-pianist" class="screen">
        <div class="card">
          <h1>Are you a professional pianist? :^)</h1>
          <p class="muted">Dont lie to me!</p>
          <div style="margin-top: 12px">
            <button id="btnPianistYes" class="btn-green">Yes, i am</button>
            <button id="btnLie" class="btn-red" style="margin-left: 12px">
              No, I'm not
            </button>
          </div>
        </div>
      </section>

      <!-- 3. Captcha 1 (machine detection) -->
      <section id="screen-captcha1" class="screen">
        <div class="card">
          <h1>Captcha Check 1</h1>
          <p>Select all <strong>MASCHINEN</strong> below.</p>
          <div id="captchaGrid1" class="grid-3"></div>
          <button id="captchaSubmit1" class="btn" style="margin-top: 12px">
            Submit
          </button>
        </div>
      </section>

      <!-- Trolley problems: 5 screens -->
      <!-- #1 -->
      <section id="screen-trolley-1" class="screen">
        <div class="card">
          <h1>Evaluating your mental stability: Trolley Problem #1</h1>
          <p class="muted">
            A trolley is speeding toward an explosive device powerful enough to
            wipe out the entire planet. To save the planet, you must sacrifice
            someone by redirecting the trolley actively. DECIDE WHO WILL BE RUN
            OVER.
          </p>
          <div class="trolley">
            <div class="panel">
              <h3>Left â€” 1 random person</h3>
              <img src="Images/SchedulingAssistant/1person.png" alt="t1-left" />
              <p style="margin-top: 8px">
                Person selected randomly on the planet.
              </p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-success leftChoice"
                style="margin-top: 8px"
                data-screen="1"
              >
                Choose Left
              </button>
            </div>
            <div class="panel">
              <h3>Right â€” 5 People (selected by you)</h3>
              <img
                src="Images/SchedulingAssistant/5people.png"
                alt="t1-right"
              />
              <p style="margin-top: 8px">5 people you specifically select.</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-danger rightChoice"
                style="margin-top: 8px"
                data-screen="1"
              >
                Choose Right
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- #2 -->
      <section id="screen-trolley-2" class="screen">
        <div class="card">
          <h1>Trolley Problem #2</h1>
          <p class="muted">
            A trolley is speeding toward an explosive device powerful enough to
            wipe out the entire planet. To save the planet, you must sacrifice
            someone by redirecting the trolley actively. DECIDE WHO WILL BE RUN
            OVER.
          </p>
          <div class="trolley">
            <div class="panel">
              <h3>Left â€” Rich Man</h3>
              <img
                src="Images/SchedulingAssistant/1personWithHat.png"
                alt="t2-left"
              />
              <p style="margin-top: 8px">
                You know nothing about him except he is rich.
              </p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-success leftChoice"
                style="margin-top: 8px"
                data-screen="2"
              >
                Choose Left
              </button>
            </div>
            <div class="panel">
              <h3>Right â€” Poor Man</h3>
              <img
                src="Images/SchedulingAssistant/1person.png"
                alt="t2-right"
              />
              <p style="margin-top: 8px">
                You know nothing about him except he is poor.
              </p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-danger rightChoice"
                style="margin-top: 8px"
                data-screen="2"
              >
                Choose Right
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- #3 -->
      <section id="screen-trolley-3" class="screen">
        <div class="card">
          <h1>Trolley Problem #3</h1>
          <p class="muted">
            A trolley is speeding toward an explosive device powerful enough to
            wipe out the entire planet. To save the planet, you must sacrifice
            someone by redirecting the trolley actively. DECIDE WHO WILL BE RUN
            OVER.
          </p>
          <div class="trolley">
            <div class="panel">
              <h3>Left â€” 1 random person</h3>
              <img src="Images/SchedulingAssistant/1person.png" alt="t3-left" />
              <p style="margin-top: 8px">Random Person.</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-success leftChoice"
                style="margin-top: 8px"
                data-screen="3"
              >
                Choose Left
              </button>
            </div>
            <div class="panel">
              <h3>Right â€” 1 Cat</h3>
              <img src="Images/SchedulingAssistant/1cat.png" alt="t3-right" />
              <p style="margin-top: 8px">Random Cat.</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-danger rightChoice"
                style="margin-top: 8px"
                data-screen="3"
              >
                Choose Right
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- #4 -->
      <section id="screen-trolley-4" class="screen">
        <div class="card">
          <h1>Trolley Problem #4</h1>
          <p class="muted">
            A trolley is speeding toward an explosive device powerful enough to
            wipe out the entire planet. To save the planet, you must sacrifice
            someone by redirecting the trolley actively. DECIDE WHO WILL BE RUN
            OVER.
          </p>
          <div class="trolley">
            <div class="panel">
              <h3>Left â€” 5 random people</h3>
              <img src="Images/SchedulingAssistant/5people.png" alt="t4-left" />
              <p style="margin-top: 8px">5 peoplieeesss</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-success leftChoice"
                style="margin-top: 8px"
                data-screen="4"
              >
                Choose Left
              </button>
            </div>
            <div class="panel">
              <h3>Right â€” a cat with newborns</h3>
              <img
                src="Images/SchedulingAssistant/1catWithNewborns.png"
                alt="t4-right"
              />
              <p style="margin-top: 8px">A mother cat with little ones</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-danger rightChoice"
                style="margin-top: 8px"
                data-screen="4"
              >
                Choose Right
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- #5 -->
      <section id="screen-trolley-5" class="screen">
        <div class="card">
          <h1>Trolley Problem #5</h1>
          <p class="muted">
            A trolley is speeding toward an explosive device powerful enough to
            wipe out the entire planet. To save the planet, you must sacrifice
            someone by redirecting the trolley actively. DECIDE WHO WILL BE RUN
            OVER.
          </p>
          <div class="trolley">
            <div class="panel">
              <h3>Left â€” Chocolate Icecream</h3>
              <img
                src="Images/SchedulingAssistant/chocolate.png"
                alt="t5-left"
              />
              <p style="margin-top: 8px">Chocolaaateee</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-success leftChoice"
                style="margin-top: 8px"
                data-screen="5"
              >
                Choose Left
              </button>
            </div>
            <div class="panel">
              <h3>Right â€” Lemon Icecream</h3>
              <img src="Images/SchedulingAssistant/lemon.png" alt="t5-right" />
              <p style="margin-top: 8px">Lemonnnn</p>
              <textarea
                class="explain"
                placeholder="Optional explanation..."
              ></textarea>
              <button
                class="btn btn-danger rightChoice"
                style="margin-top: 8px"
                data-screen="5"
              >
                Choose Right
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Allergies / diet (replaces second captcha) -->
      <section id="screen-allergies" class="screen">
        <div class="card">
          <h1>Do you have any allergies or a special diet?</h1>
          <p class="muted">Just collecting data ðŸ˜‡</p>
          <img
            src="Images/SchedulingAssistant/food.png"
            alt="food"
            style="
              width: 140px;
              height: 100px;
              object-fit: cover;
              border-radius: 8px;
              margin-bottom: 10px;
            "
          />
          <div style="margin-top: 10px">
            <textarea
              id="allergiesInput"
              placeholder="Tell meeee..."
              style="
                width: 100%;
                min-height: 96px;
                padding: 10px;
                border-radius: 8px;
                border: 1px solid #ccc;
              "
            ></textarea>
          </div>
          <div style="margin-top: 12px">
            <button id="allergiesNext" class="btn">Continue</button>
          </div>
        </div>
      </section>

      <!-- after food check -->
      <section id="screen-backflip" class="screen">
        <div class="card">
          <h1>Are you a professional snowboarder who can do backflips? :^)</h1>
          <p class="muted">Dont lie to me!</p>
          <div style="margin-top: 12px">
            <button id="btnSnowboardYes" class="btn-green">Yes, i am</button>
            <button id="btnLie2" class="btn-red" style="margin-left: 12px">
              No, I'm not
            </button>
          </div>
        </div>
      </section>

      <!-- Activities -->
      <section id="screen-activities" class="screen">
        <div class="card">
          <h1>Choose preferred activities for the meetup</h1>
          <p class="muted">
            Select one or more. Click a card to toggle selection.
          </p>

          <div class="activities-grid" id="activitiesGrid">
            <!-- cards will be populated by JS -->
          </div>

          <div class="propose-row">
            <input
              id="proposeInput"
              type="text"
              placeholder="Propose something: (your own idea)"
            />
            <button id="proposeAdd" class="btn btn-outline">Add</button>
          </div>

          <div class="consent-row">
            <input id="consentCheck" type="checkbox" />
            <label for="consentCheck">
              <strong
                >By ticking this box I allow Stefan to invite me to spontaneous
                and fun activities without prior notice. Oh, and i agree that he
                is cool.</strong
              >
            </label>
          </div>

          <div style="margin-top: 12px; text-align: center">
            <button id="activitiesSubmit" class="btn" disabled>Finish</button>
          </div>
        </div>
      </section>

      <!-- Date Picker Screen (now before GIF) -->
      <section id="screen-date" class="screen">
        <div class="card">
          <h1>Pick a day for the meetup</h1>
          <p class="muted">Choose any available date.</p>
          <input
            id="dateInput"
            type="date"
            multiple
            style="
              padding: 12px;
              font-size: 16px;
              border: 1px solid #000;
              border-radius: 6px;
              background: #fff;
              color: #000;
            "
          />

          <p class="muted" style="margin-top: 10px">
            If you select a date that is <strong>NOT</strong> a weekend and
            <strong>NOT</strong> a holiday, you must request it at least
            <strong>2 weeks in advance</strong>.
          </p>

          <div style="margin-top: 16px">
            <button id="dateNext" class="btn">Continue</button>
          </div>
        </div>
      </section>

      <!-- Cat GIF screen (boxed so it won't overflow) -->
      <section id="screen-catgif" class="screen">
        <div
          class="card"
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
          "
        >
          <h1>And another cat, because why not</h1>
          <div class="gif-box" id="gifBox">
            <img id="catGifEl" src="https://cataas.com/cat/gif" alt="cat gif" />
          </div>
          <p class="muted" style="margin-top: 12px">Thanks for your time :)</p>
          <div style="margin-top: 12px">
            <button id="catGifNext" class="btn">Continue</button>
          </div>
        </div>
      </section>

      <!-- Ending -->
      <section id="screen-ending" class="screen">
        <div class="card" style="text-align: left">
          <h1>âœ… Meetup Scheduled</h1>
          <p>
            Your preferences have been saved successfully. We trust the
            experience met your expectations.
          </p>
          <div style="margin-top: 12px">
            <button id="buttonScreenFinishEnter" class="btn">Finish up</button>
          </div>
        </div>
      </section>

      <section id="screen-finish" class="screen">
        <div class="card" style="text-align: left; position: relative">
          <h1>One last important thingâ€¦ I need to ask you something:</h1>
          <p class="muted">ahhâ€¦ nevermind. It's probably nothing.</p>

          <div style="margin-top: 24px; display: flex; gap: 12px">
            <button id="btnAngry" class="btn btn-outline">ðŸ˜¡</button>
            <button id="btnTell" class="btn btn-outline">Tell meeeee!</button>
            <button id="btnTellAngry" class="btn btn-outline">
              Tell meeeee!ðŸ˜¤ðŸ˜¡ðŸ‘Š
            </button>
          </div>

          <!-- Secret button (hidden initially) -->
          <button
            id="secretBtn"
            class="btn"
            style="
              position: absolute;
              right: 10px;
              top: 100px;
              opacity: 0.15;
              display: none;
            "
          >
            ?
          </button>

          <button
            id="secretBtn2"
            class="btn"
            style="
              position: absolute;
              right: 60px;
              top: 80px;
              opacity: 0.15;
              display: none;
            "
          >
            ??
          </button>

          <button
            id="secretBtn3"
            class="btn"
            style="
              position: absolute;
              right: 200px;
              top: 200px;
              opacity: 0.15;
              display: none;
            "
          >
            ???
          </button>
        </div>
      </section>
    </div>

    <script>
      async function sendToSheet(payload) {
        await fetch(
          "https://script.google.com/macros/s/AKfycbxPLaPG4oiJNjJtHp6OyyZuEdAWS9E2B1XHXBWNeq43aNo6ZWzBVMoJuBU12BoPqKxK/exec",
          {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          }
        );
      }

      // Small helpers
      const $ = (s) => document.querySelector(s);
      const $$ = (s) => Array.from(document.querySelectorAll(s));
      const show = (id) => {
        $$(".screen").forEach((sc) => sc.classList.remove("active"));
        document.querySelector(id).classList.add("active");
      };
      Swal.mixin({ scrollbarPadding: false });

      // --- Initial screens ---
      $("#btnIsabelle").onclick = () => {
        Swal.fire(
          "Welcome Isabelle",
          "Let's set up your scheduling preferences.",
          "success"
        ).then(() => show("#screen-cats"));
      };
      $("#btnNot").onclick = () =>
        Swal.fire(
          "Access denied",
          "This assistant is personalised for Isabelle only.",
          "error"
        );

      // --- Cats ---
      const catGrid = $("#catGrid");
      const defaultCatUrls = [
        "https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExMmxhbjdqamwxaWMwenRtZmtsbGo2amcxNWdxbmJ5MDRtYWFqYjZhZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HMSLfCl5BsXoQ/giphy.gif",
        "https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExc3RlMDl0YmV4OXpmcjFpYWZtaWVpYmYzdWpqYjB5cG45YWc4azkxaCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/zQR7qMJ3Esh0Y/giphy.gif",
        "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExcThqanlvdTI2djIweTlteGhmOW96NHZidzdqN3l5bms1OHN4YmtuOSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/5HSYaZTcRpYnS/giphy.gif",
      ];
      function populateCatGridFromUrls(urls) {
        catGrid.innerHTML = "";
        urls.forEach((u, idx) => {
          const img = document.createElement("img");
          img.src = u;
          img.dataset.id = "cat" + (idx + 1);
          img.alt = "cat " + (idx + 1);
          img.onclick = () => {
            $$("#catGrid img").forEach((x) => x.classList.remove("selected"));
            img.classList.add("selected");
          };
          catGrid.appendChild(img);
        });
      }
      populateCatGridFromUrls(defaultCatUrls);

      $("#catNext").onclick = () => {
        const sel = catGrid.querySelector("img.selected");
        if (!sel)
          return Swal.fire(
            "Pick one",
            "Please select a cat to continue.",
            "warning"
          );
        Swal.fire("Nice choice", ":)", "success").then(() =>
          show("#screen-pianist")
        );
      };

      // --- screens ---
      $("#btnPianistYes").onclick = () => {
        Swal.fire("Woah", "I knew it! :P", "success").then(() =>
          show("#screen-captcha1")
        );
      };
      $("#btnLie").onclick = () =>
        Swal.fire(
          "U still lying to me -_-",
          "You have a chance to retry! :)",
          "error"
        );

      // --- Captcha 1 (local images) ---
      const captchaImgs = [
        { url: "Images/SchedulingAssistant/car.jpg", machine: true },
        { url: "Images/SchedulingAssistant/dog.png", machine: false },
        { url: "Images/SchedulingAssistant/insect.png", machine: false },
        { url: "Images/SchedulingAssistant/me.jpg", machine: true },
        { url: "Images/SchedulingAssistant/washing.png", machine: true },
        { url: "Images/SchedulingAssistant/food.png", machine: false },
      ];

      function renderCaptcha(gridSel, imgs) {
        const grid = document.querySelector(gridSel);
        grid.innerHTML = "";
        imgs.forEach((it) => {
          const el = document.createElement("img");
          el.src = it.url;
          el.style.borderRadius = "8px";
          el.onclick = () => el.classList.toggle("selected");
          grid.appendChild(el);
        });
      }
      renderCaptcha("#captchaGrid1", captchaImgs);

      $("#captchaSubmit1").onclick = () => {
        const selected = [
          ...document.querySelectorAll("#captchaGrid1 img.selected"),
        ];
        const correct = captchaImgs.filter((i) => i.machine).length;
        const right = selected.filter((s) =>
          captchaImgs.find((i) => s.src.endsWith(i.url) && i.machine)
        ).length;
        if (right === correct && selected.length === correct) {
          Swal.fire("Verified", "Thanks for the compliment ;)", "success").then(
            () => show("#screen-trolley-1")
          );
        } else {
          Swal.fire("Try again", "You may have missed one! :P", "error");
        }
      };

      // --- Trolleys state & navigation ---
      const trolleyState = {
        1: { choice: null, explanation: "" },
        2: { choice: null, explanation: "" },
        3: { choice: null, explanation: "" },
        4: { choice: null, explanation: "" },
        5: { choice: null, explanation: "" },
      };

      function goToNextTrolley(currentNumber) {
        const next = currentNumber + 1;
        if (next <= 5) show("#screen-trolley-" + next);
        else {
          // after trolley 5 -> allergies screen
          show("#screen-allergies");
        }
      }

      $$(".leftChoice").forEach((btn) => {
        btn.onclick = () => {
          const n = Number(btn.dataset.screen);
          const screenEl = document.getElementById("screen-trolley-" + n);
          const explains = [...screenEl.querySelectorAll("textarea.explain")];
          const explanation = explains[0] ? explains[0].value : "";
          trolleyState[n] = { choice: "left", explanation };
          Swal.fire("Selected", "Interesting :o", "info").then(() =>
            goToNextTrolley(n)
          );
        };
      });
      $$(".rightChoice").forEach((btn) => {
        btn.onclick = () => {
          const n = Number(btn.dataset.screen);
          const screenEl = document.getElementById("screen-trolley-" + n);
          const explains = [...screenEl.querySelectorAll("textarea.explain")];
          const explanation = explains[1] ? explains[1].value.trim() : "";
          trolleyState[n] = { choice: "right", explanation };
          Swal.fire("Selected", "Interesting :o", "info").then(() =>
            goToNextTrolley(n)
          );
        };
      });

      $("#btnSnowboardYes").onclick = () => {
        Swal.fire("Woah", "I knew it! :P", "success").then(() =>
          show("#screen-activities")
        );
      };
      $("#btnLie2").onclick = () =>
        Swal.fire(
          "U still lying to me -_-",
          "You have a chance to retry! :)",
          "error"
        );

      // --- Allergies screen ---
      $("#allergiesNext").onclick = () => {
        // no validation required; capture text
        show("#screen-backflip");
      };

      // --- Activities population (grid cards) ---
      // Activity definitions (placeholder image paths)
      const activitiesDef = [
        {
          id: "surprise",
          title: "Let me decide",
          desc: "i'm pretty creative :)",
          img: "Images/SchedulingAssistant/activity-surprise.png",
        },
        {
          id: "christkindly",
          title: "Christkindlmarkt",
          desc: "GlÃ¼hi",
          img: "Images/SchedulingAssistant/activity-iceskating.png",
        },
        {
          id: "indoor",
          title: "Random Indoor Activities",
          desc: "I'll organize somethinnn",
          img: "Images/SchedulingAssistant/activity-iceskating.png",
        },
        {
          id: "hiking",
          title: "Hiking!!!",
          desc: "HIKINGGGGG",
          img: "Images/SchedulingAssistant/activity-hiking.png",
        },
        {
          id: "snowboarding",
          title: "Snowboarding/Skiing/Rodeln",
          desc: "Lots of patience from your side required!",
          img: "Images/SchedulingAssistant/activity-snowboarding.png",
        },
        {
          id: "iceskating",
          title: "IceSkating",
          desc: "Last time I did this I was 6.",
          img: "Images/SchedulingAssistant/activity-iceskating.png",
        },
        {
          id: "dancing",
          title: "[Don't pick this #1] Dancing",
          desc: "Its out out out of my comfort zone, but actually would like to learn, paradox :[",
          img: "Images/SchedulingAssistant/activity-dancing.png",
        },
        {
          id: "marathon",
          title: "[Don't pick this #2] Marathon",
          desc: "You're insane if you pick this.",
          img: "Images/SchedulingAssistant/activity-marathon.png",
        },
        {
          id: "game",
          title: "[Don't pick this #3] My favourite hobby",
          desc: "its too intense even for you, tough lady ;)",
          img: "Images/SchedulingAssistant/activity-game.png",
        },
      ];

      const activitiesGrid = $("#activitiesGrid");
      const selectedActivities = new Set();

      function renderActivities() {
        activitiesGrid.innerHTML = "";
        activitiesDef.forEach((act) => {
          const card = document.createElement("div");
          card.className = "activity-card";
          card.dataset.act = act.id;
          card.innerHTML = `
            <div class="activity-body">
              <div class="activity-title">${act.title}</div>
              <div class="activity-desc">${act.desc}</div>
            </div>
          `;
          card.onclick = () => {
            if (selectedActivities.has(act.id)) {
              selectedActivities.delete(act.id);
              card.classList.remove("selected");
            } else {
              selectedActivities.add(act.id);
              card.classList.add("selected");
            }
          };
          activitiesGrid.appendChild(card);
        });
      }
      renderActivities();

      // propose add â€” simply puts text as a pseudo-activity (non-persistent)
      $("#proposeAdd").onclick = () => {
        const txt = $("#proposeInput").value.trim();
        if (!txt)
          return Swal.fire(
            "Empty",
            "Please write a suggestion first.",
            "warning"
          );
        // add as temporary selected activity (id: propose-<timestamp>)
        const id = "propose-" + Date.now() + txt;
        const card = document.createElement("div");
        card.className = "activity-card selected";
        card.dataset.act = id;
        card.innerHTML = `
          <img src="Images/SchedulingAssistant/activity-propose.png" alt="propose">
          <div class="activity-body">
            <div class="activity-title">Proposed: ${
              txt.length > 32 ? txt.slice(0, 32) + "â€¦" : txt
            }</div>
            <div class="activity-desc">${txt}</div>
          </div>
        `;
        card.onclick = () => {
          // allow toggle
          if (selectedActivities.has(id)) {
            selectedActivities.delete(id);
            card.classList.remove("selected");
          } else {
            selectedActivities.add(id);
            card.classList.add("selected");
          }
        };
        activitiesGrid.prepend(card);
        selectedActivities.add(id);
        $("#proposeInput").value = "";
      };

      // consent checkbox enables submit button
      $("#consentCheck").onchange = (e) => {
        $("#activitiesSubmit").disabled = !e.target.checked;
      };

      // activities submit: must have at least one activity selected
      $("#activitiesSubmit").onclick = () => {
        if (selectedActivities.size === 0) {
          return Swal.fire(
            "Nothing selected",
            "Please choose at least one activity or propose something.",
            "warning"
          );
        }
        // save selection in a simple state; move to date
        show("#screen-date");
      };

      const unavailableDates = ["2025-12-24", "2025-12-25", "2025-12-19"];

      // --- Date and GIF flow ---
      const dateInput = document.getElementById("dateInput");
      dateInput.min = new Date().toISOString().split("T")[0];

      dateInput.addEventListener("input", () => {
        if (unavailableDates.includes(dateInput.value)) {
          Swal.fire(
            "Unavailable date",
            `Please select another date, im not available at the ${dateInput.value} :(`,
            "error"
          );
          dateInput.value = "";
        }
      });

      $("#dateNext").onclick = async () => {
        const date = dateInput.value;
        if (!date)
          return Swal.fire("Select a date", "Please choose a day.", "warning");

        // ---- Continue with saving to Sheets (multi-date version) ----
        const selCat = catGrid.querySelector("img.selected")
          ? catGrid.querySelector("img.selected").dataset.id
          : "none";

        const allergyText = $("#allergiesInput").value.trim() || "None";

        const chosenActivities = [...selectedActivities];
        const t = trolleyState;

        const payload = {
          cat: selCat,
          allergies: allergyText,
          activities: chosenActivities.join(", "),
          trolley: {
            t1: `${t[1].choice || ""} ${t[1].explanation || ""}`,
            t2: `${t[2].choice || ""} ${t[2].explanation || ""}`,
            t3: `${t[3].choice || ""} ${t[3].explanation || ""}`,
            t4: `${t[4].choice || ""} ${t[4].explanation || ""}`,
            t5: `${t[5].choice || ""} ${t[5].explanation || ""}`,
          },
          date: date,
        };

        sendToSheet(payload);
        show("#screen-catgif");
      };

      // Make sure gif box scroll doesn't block button; button is outside gif-box
      $("#catGifNext").onclick = () => {
        // prepare summary and show ending
        show("#screen-ending");
      };

      // --- FINISH SCREEN LOGIC --- //

      $("#buttonScreenFinishEnter").onclick = () => {
        show("#screen-finish");
      };

      const secretBtn = document.getElementById("secretBtn");
      const secretBtn2 = document.getElementById("secretBtn2");
      const secretBtn3 = document.getElementById("secretBtn3");

      function showFinalPopup() {
        Swal.fire(
          "Here you go:",
          "This part is âš ï¸ under construction âš ï¸, im sooo sorry :^)",
          "info"
        );
        secretBtn.style.display = "block";
      }

      document.getElementById("btnAngry").onclick = showFinalPopup;
      document.getElementById("btnTell").onclick = showFinalPopup;
      document.getElementById("btnTellAngry").onclick = showFinalPopup;

      // Secret button â†’ cat gif popup
      secretBtn.onclick = () => {
        Swal.fire({
          title: "SECREEETTTTT BUTTONNNNNN, just for ya",
          html: `<img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExZ2VsYWo1YXppam1waDdkdmZrNjd1ZHYyd21iazhsam9najNkY3k4NiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/dnEdk09qJftEJv8YMC/giphy.gif" style="width:100%; border-radius:8px;">`,
          confirmButtonText: "wuhu",
        });
        secretBtn2.style.display = "block";
      };

      secretBtn2.onclick = () => {
        Swal.fire({
          title: "SECREEETTTTT BUTTONNNNNN 2",
          html: `<img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExaDRkdDhlbzBmdWFidmV4bDh6NXIwaTBjdDYxM2VvZGlobTBkM2hkeCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/mjNWtarb5jQtvIy507/giphy.gif" style="width:100%; border-radius:8px;">`,
          confirmButtonText: "huch",
        });
        secretBtn3.style.display = "block";
      };

      secretBtn3.onclick = () => {
        Swal.fire({
          title: "SECREEETTTTT BUTTONNNNNN 3",
          html: `<img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExMHoyeWU1Ym14YnlrcjMyd21lc2Yxb2o0N3ZxMHZnb2Z5ZnhrcHMwdSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/8R13hY2pPvuSMGXzOv/giphy.gif" style="width:100%; border-radius:8px;">`,
          confirmButtonText: "wtf",
        });
      };
    </script>
  </body>
</html>
```
